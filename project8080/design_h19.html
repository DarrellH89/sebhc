<html>
<!-- Mirrored from davidwallace2000.home.comcast.net/~davidwallace2000/h8/project8080_archive/design_h19.html by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 10 Sep 2012 13:15:36 GMT -->
<head><title>Heath8080A - Product Design : H-19 Terminal</title><!-- Headers -- common to all pages --><meta name="description" content="This site provides a free Heathkit H8 microcomputer emulator for the Macintosh"><meta name="author" content="David A. Shaw"><link rev="made" href="mailto:&#104;&#101;&#97;&#116;&#104;8080&#97;&#64;&#97;&#111;&#108;.&#99;&#111;&#109;"><meta name="generator" content="Optima PageSpinner for MacOS"><meta name="robots" content="all"><meta name="keywords" content="Heathkit,Heath,H8,H17,H-17,H19,H-19,8080A,Intel 8080A,computer emulation,H8 emulation,Mac,Macintosh,G3,Linux"><style type="text/css">body {background-color: #ffffff}.left   { background:      #ffffff; vertical-align: top; color: blue }.left p { font-family:     verdana        }.head   { background:     #ffffcc; vertical-align: top; color: blue }.head p { font-family:    geneva, arial        }.lhead   { background:     #ffffcc; vertical-align: top; color: blue }.lhead p { font-family:    verdana         }.body   { vertical-align: top;}.body p, ul, ol, dl         { font-family:    geneva, arial         }div.c1 { font-family: geneva, arial;  text-align: center }div.c2 { font-family: geneva, arial;  text-align: right  }a:visited {color: green }a:hover   {color: red; text-decoration: none }p.outside {font-family: geneva, arial;font-size: small;}pre { font-family: courier; font-size: 10px }h1, h2 {font-family: "times new roman" }</style></head><body><a name="top"></a><!-- Page Heading -- common to all pages --><table border="0" cellspacing="0" cellpadding="4" width="100%"><tr>	<td class="lhead">		<p><b>Heath8080A &#8212; Product Design : H-19 Terminal</b></p>	</td>	<td class="head" align="right"><!-- this reads "site" on the index page and "page" on all others -->		<font size="-1"><p>Page last updated</p></font>	</td></tr><tr>	<td class="head">		<font size="-1"><p><a href="index.html" onMouseOver="self.status='Go to home page'; return true">home</a>		&nbsp;&nbsp;<a href="release.html" onMouseOver="self.status='Go to release page'; return true">release</a>		&nbsp;&nbsp;<a href="support.html" onMouseOver="self.status='Go to support page'; return true">support</a>		&nbsp;&nbsp;<a href="design.html" onMouseOver="self.status='Go to design page'; return true">design</a>		&nbsp;&nbsp;<a href="resources.html" onMouseOver="self.status='Go to resources page'; return true">resources</a>		&nbsp;&nbsp;<a href="legal.html" onMouseOver="self.status='Go to legal page'; return true">legal</a>		&nbsp;&nbsp;<a href="sitemap.html" onMouseOver="self.status='Go to site map'; return true">site map</a></p></font>	</td>	<td class="head" align="right">		<font size="-1"><p>21-December-2002</p></font>	</td></tr><tr><td>&nbsp;</td></tr></table><!-- Standard content ends. Page body starts here.  --><table border="0" cellspacing="0" cellpadding="4" width="100%"><tr><!-- page index --><td class="left" width="20%"><font size="-1"><p>On this page</p><p>&#149; <a href="#overview" onMouseOver="self.status='Go to overview'; return true">overview</a><br>&#149; <a href="#keyboard" onMouseOver="self.status='Go to keyboard mapping'; return true">keyboard mapping</a><br>&#149; <a href="#graphics" onMouseOver="self.status='Go to character mapping'; return true">graphic characters</a><br>&#149; <a href="#pacing" onMouseOver="self.status='Go to character pacing'; return true">character pacing</a><br>&#149; <a href="#output" onMouseOver="self.status='Go to output processing'; return true">output processing</a><br>&#149; <a href="#cursor" onMouseOver="self.status='Go to cursor display'; return true">cursor display</a><br></p><p>Related links</p><p>&#149; <a href="design_arch.html" onMouseOver="self.status='Go to system architecture'; return true">system architecture</a><br>&#149; <a href="design_io.html" onMouseOver="self.status='Go to i/o package'; return true">i/o package</a><br></p></font></td><td class="body"><font size="-1"><p><b>H-19 Terminal</b></p><p>This page describes the emulator's implementation of the H-19 terminal.</p><p>A complete emulation of the H-19 was not completed; the device has a number of capabilities, such as the ability to interpret a set of ANSI escape sequences, that were not implemented. Refer to <a href="support.html#limitations" onMouseOver="self.status='Go to limitations'; return true">limitations</a> for a complete list.</p><hr><a name="overview"></a><p><b>H-19 Overview</b></p><p>The H-19 Emulator supports the following capabilities.</p><p><i>Power-on configuration</i></p><ul><li>underscore cursor;</li><li>discard at end of line (no wrap from column 80);</li><li>no auto-CR or auto-LF;</li><li>Heath-mode escape sequences (ANSI will not be supported at all);</li><li>keypad normal and unshifted.</li></ul><p>All but Heath-mode escape sequences can be overridden by escape sequences after the emulator is started.</p><p>Tabs will be fixed at columns 9, 17, 25, 33, 41, 49, 57, 65, 73,  74, 75, 76, 77, 78, 79 and 80. A tab from column 80 will not move the cursor.</p><p><i>Block Diagram</i></p><p><b>Note:</b> The words "transmit" and "receive" are used from the viewpoint of the H8, not the H-19.</p><img src="gfx/h19block.gif" width="286" height="153" hspace="4" vspace="4" align="right" border="0" alt="H-19 Block Diagram"><p>In order to support "scroll mode," characters are received into a buffer. The H-19 issues Xoff when the buffer is 80% full and Xon when the buffer is 25% full.</p><p>Mac keystrokes are translated and passed into a pacing buffer so that multiple-character sequences don't overrun the serial port (remember, we don't have an actual, slow serial line to slow things naturally). Incoming characters are paced at a rate of 200 cps.</p><p>The emulator can put characters into the receiver buffer in two cases:</p><ol><li><p>It needs to issue Xon or Xoff.</p></li><li><p>A "transmit page" or "transmit 25th line" operation is executed. These operations can result in a burst of input that greatly exceeds the screen size.</p></li></ol><p>As of release 5.3.2, you can paste text from the clipboard into the H-19 window. This text is sent to the H8 as if it were typed at the keyboard. The paste buffer is not passed through the receiver buffer; rather, the emulator bypasses the receiver buffer when pasting text. Pasted text and text coming from the keyboard or H-19 buffer will not intermingle.</p><p>The H-19 terminal window has a "spring open" feature. If the terminal window has not been displayed since the emulator was started, the first printable character output will cause the window to open in front of the PAM/8 GUI. This allows the user to key the boot address and press "go" and be able to use the H-19 immediately without fooling around with emulator menus.</p><p>When booting an HDOS 1.6 disk or a newly-sysgened HDOS 2.0 disk, HDOS will sound PAM/8's alarm and display "SPACE" in the front-panel LEDs to prompt the user to press the space key so HDOS can determine the terminal baud rate. In this instance, the user will have to manually display the terminal window before pressing space.</p><p><a href="#top" onMouseOver="self.status='go to the top of this page'; return true">go to top</a></p><hr><a name="keyboard"></a><p><b>Keyboard Mapping</b></p><p><i>Keyboard Processing Overview</i></p><p>The Macintosh key-down event record contains both an ASCII character code and a virtual key code. While several keys on the keyboard may produce the same ASCII character &#8212; there are two "=" keys, for example &#8212; there is a one-to-one mapping between physical keys and virtual key codes that is consistent across all Macintosh keyboard layouts.</p><p>It's most convenient to use the virtual key code to identify keys to be mapped to H-19 emulation functions. In the documentation that follows, "virtual key code" refers to the unique key identifier and "ASCII character code" refers to the normal ASCII value of the keystroke.</p><p>The main body of the Macintosh keyboard has virtual key codes less than 0x41. All other key codes are equal to or greater than 0x41. This is actually a quite convenient bit of luck, in that it improves keyboard translation performance on the touch-typing keys. In pseudo-code, keyboard translation proceeds as follows:<ul><pre>if (virtual key code is less than 0x41)  if (the option key is down)    translate key code against main keyboard function key table    (option-1 = F1, etc.)    if ( no hit in table )      if ( virtual key code = scroll key or break key )        handle these keys locally  else    send the ASCII character code to the H8 serial portelse // virtual key code must be >= 0x41  if ( virtual key code = the clear key )    handle clear locally  else if ( virtual key code = top row F9 )    handle scroll locally  else if (virtual key code = top row F12)    handle break locally  else    if ((shift_mode xor shift_key) == '1')      translate key code against the shifted keypad table      (cursor keys, insert/delete char, etc.)      if (no hit in table)        if (virtual key code = IC key)          if ( we are in insert-character mode )               send  exit-insert-character-mode sequence          else send enter-insert-character-mode sequence      else if (alternate keypad mode set)            translate key code against the alternate keypad table    else      translate key code against the normal keypad tableend</pre></ul><p>The search tables have the following format:</p><ul><pre>typedef struct {    unsigned char vkc;    // virtual key code    char *str;            // output string} keyXlateTab, *keyXlateTabPtr;</pre></ul><p>Each table is sorted in virtual key code order. The last vkc in the table is 0xff. If there is no match in the table, and with the exception of the keys handled separately as noted in the pseudo code above, the keystroke will be ignored.</p><p><i>Keyboard Translation</i></p><p>The "keyboard translation" function (ref. <a href="#overview" onMouseOver="self.status='Display overview'; return true">h-19 overview</a>) will perform the following mappings:</p><!-- PF key mapping table --><ul><table border="1" cellspacing="0" cellpadding="4"><caption><font face="Geneva,Arial" size="-1"><b>Function Key Mapping</b></caption><tr align="center" valign="top">	<th class="body"><font size="-1"><p>H-19 Key</p></th>	<th class="body"><font size="-1"><p>Mac Key</p></th>	<th class="body"><font size="-1"><p>Virtual Key Code</p></th>	<th class="body"><font size="-1"><p>Output Sequence</p></th></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>F1</p></td>	<td class="body"><font size="-1"><p>F1</p></td>	<td class="body"><font size="-1"><p>0x7a</p></td>	<td class="body"><font size="-1"><p>esc S</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>F2</p></td>	<td class="body"><font size="-1"><p>F2</p></td>	<td class="body"><font size="-1"><p>0x78</p></td>	<td class="body"><font size="-1"><p>esc T</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>F3</p></td>	<td class="body"><font size="-1"><p>F3</p></td>	<td class="body"><font size="-1"><p>0x63</p></td>	<td class="body"><font size="-1"><p>esc U</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>F4</p></td>	<td class="body"><font size="-1"><p>F4</p></td>	<td class="body"><font size="-1"><p>0x76</p></td>	<td class="body"><font size="-1"><p>esc V</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>F5</p></td>	<td class="body"><font size="-1"><p>F5</p></td>	<td class="body"><font size="-1"><p>0x60</p></td>	<td class="body"><font size="-1"><p>esc W</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Erase</p></td>	<td class="body" colspan="3" align="left"><font size="-1">	<p>Replaced with the keypad <b>Clear</b> key. See "Other Mac Key Mappings" table below.</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Blue</p></td>	<td class="body"><font size="-1"><p>F6</p></td>	<td class="body"><font size="-1"><p>0x61</p></td>	<td class="body"><font size="-1"><p>esc P</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Red</p></td>	<td class="body"><font size="-1"><p>F7</p></td>	<td class="body"><font size="-1"><p>0x62</p></td>	<td class="body"><font size="-1"><p>esc Q</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Gray</p></td>	<td class="body"><font size="-1"><p>F8</p></td>	<td class="body"><font size="-1"><p>0x64</p></td>	<td class="body"><font size="-1"><p>esc R</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Scroll</p></td>	<td class="body"><font size="-1"><p>F9</p></td>	<td class="body"><font size="-1"><p>0x65</p></td>	<td class="body"><font size="-1"><p>(1)</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Break</p></td>	<td class="body"><font size="-1"><p>F12</p></td>	<td class="body"><font size="-1"><p>0x6f</p></td>	<td class="body"><font size="-1"><p>(2)</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>&nbsp;</p></td>	<td class="body"><font size="-1"><p>&nbsp;</p></td>	<td class="body"><font size="-1"><p>&nbsp;</p></td>	<td class="body"><font size="-1"><p>&nbsp;</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>F1</p></td>	<td class="body"><font size="-1"><p>option-1</p></td>	<td class="body"><font size="-1"><p>0x12 (w/ option)</p></td>	<td class="body"><font size="-1"><p>esc S</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>F2</p></td>	<td class="body"><font size="-1"><p>option-2</p></td>	<td class="body"><font size="-1"><p>0x13 (w/ option)</p></td>	<td class="body"><font size="-1"><p>esc T</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>F3</p></td>	<td class="body"><font size="-1"><p>option-3</p></td>	<td class="body"><font size="-1"><p>0x14 (w/ option)</p></td>	<td class="body"><font size="-1"><p>esc U</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>F4</p></td>	<td class="body"><font size="-1"><p>option-4</p></td>	<td class="body"><font size="-1"><p>0x15 (w/ option)</p></td>	<td class="body"><font size="-1"><p>esc V</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>F5</p></td>	<td class="body"><font size="-1"><p>option-5</p></td>	<td class="body"><font size="-1"><p>0x17 (w/ option)</p></td>	<td class="body"><font size="-1"><p>esc W</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Erase</p></td>	<td class="body" colspan="3" align="left"><font size="-1">	<p>Replaced with the keypad <b>Clear</b> key. See "Other Mac Key Mappings" table below.</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Blue</p></td>	<td class="body"><font size="-1"><p>option-6</p></td>	<td class="body"><font size="-1"><p>0x16 (w/ option)</p></td>	<td class="body"><font size="-1"><p>esc P</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Red</p></td>	<td class="body"><font size="-1"><p>option-7</p></td>	<td class="body"><font size="-1"><p>0x1a (w/ option)</p></td>	<td class="body"><font size="-1"><p>esc Q</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Gray</p></td>	<td class="body"><font size="-1"><p>option-8</p></td>	<td class="body"><font size="-1"><p>0x1c (w/ option)</p></td>	<td class="body"><font size="-1"><p>esc R</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Scroll</p></td>	<td class="body"><font size="-1"><p>option-9</p></td>	<td class="body"><font size="-1"><p>0x19 (w/ option)</p></td>	<td class="body"><font size="-1"><p>(1)</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Break</p></td>	<td class="body"><font size="-1"><p>option-=</p></td>	<td class="body"><font size="-1"><p>0x18 (w/ option)</p></td>	<td class="body"><font size="-1"><p>(2)</p></td></tr></table></ul><p><strong>Notes:</strong></p><ol><li><p>The scroll key is a local function. When in scroll mode, pressing scroll will cause the next line of output to be displayed, and shift-scroll will cause the next page of output to be displayed. Scroll simply controls how many lines are pulled from the output buffer.</p></li><li><p>The break key will cause the Break and Framing Error bits to be set in port 350q's status register.</p></li></ol><!-- Normal, unshifted keypad --><ul><table border="1" cellspacing="0" cellpadding="4"><caption><font face="Geneva,Arial" size="-1"><b>Normal, Unshifted Keypad Mapping</b></caption><tr align="center" valign="top">	<th class="body"><font size="-1"><p>H-19 Key</p></th>	<th class="body"><font size="-1"><p>Mac Key</p></th>	<th class="body"><font size="-1"><p>Virtual Key Code</p></th>	<th class="body"><font size="-1"><p>Output Sequence</p></th></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>0</p></td>	<td class="body"><font size="-1"><p>0</p></td>	<td class="body"><font size="-1"><p>0x52</p></td>	<td class="body"><font size="-1"><p>0</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>1</p></td>	<td class="body"><font size="-1"><p>1</p></td>	<td class="body"><font size="-1"><p>0x53</p></td>	<td class="body"><font size="-1"><p>1</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>2</p></td>	<td class="body"><font size="-1"><p>2</p></td>	<td class="body"><font size="-1"><p>0x54</p></td>	<td class="body"><font size="-1"><p>2</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>3</p></td>	<td class="body"><font size="-1"><p>3</p></td>	<td class="body"><font size="-1"><p>0x55</p></td>	<td class="body"><font size="-1"><p>3</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>4</p></td>	<td class="body"><font size="-1"><p>4</p></td>	<td class="body"><font size="-1"><p>0x56</p></td>	<td class="body"><font size="-1"><p>4</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>5</p></td>	<td class="body"><font size="-1"><p>5</p></td>	<td class="body"><font size="-1"><p>0x57</p></td>	<td class="body"><font size="-1"><p>5</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>6</p></td>	<td class="body"><font size="-1"><p>6</p></td>	<td class="body"><font size="-1"><p>0x58</p></td>	<td class="body"><font size="-1"><p>6</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>7</p></td>	<td class="body"><font size="-1"><p>7</p></td>	<td class="body"><font size="-1"><p>0x59</p></td>	<td class="body"><font size="-1"><p>7</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>8</p></td>	<td class="body"><font size="-1"><p>8</p></td>	<td class="body"><font size="-1"><p>0x5b</p></td>	<td class="body"><font size="-1"><p>8</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>9</p></td>	<td class="body"><font size="-1"><p>9</p></td>	<td class="body"><font size="-1"><p>0x5c</p></td>	<td class="body"><font size="-1"><p>9</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>.</p></td>	<td class="body"><font size="-1"><p>.</p></td>	<td class="body"><font size="-1"><p>0x41</p></td>	<td class="body"><font size="-1"><p>.</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Enter</p></td>	<td class="body"><font size="-1"><p>Enter</p></td>	<td class="body"><font size="-1"><p>0x4c</p></td>	<td class="body"><font size="-1"><p>015</p></td></table></ul><br><br><!-- Shifted keypad --><ul><table border="1" cellspacing="0" cellpadding="4"><caption><font face="Geneva,Arial" size="-1"><b>Shifted Keypad Mapping</b></caption><tr align="center" valign="top">	<th class="body"><font size="-1"><p>H-19 Key</p></th>	<th class="body"><font size="-1"><p>Mac Key</p></th>	<th class="body"><font size="-1"><p>Virtual<br>Key Code</p></th>	<th class="body"><font size="-1"><p>Output<br>Sequence</p></th>	<th class="body"><font size="-1"><p>Function<br>Description</p></th></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>0</p></td>	<td class="body"><font size="-1"><p>0</p></td>	<td class="body"><font size="-1"><p>0x52</p></td>	<td class="body"><font size="-1"><p>0</p></td>	<td class="body"><font size="-1"><p>&nbsp;</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>1</p></td>	<td class="body"><font size="-1"><p>1</p></td>	<td class="body"><font size="-1"><p>0x53</p></td>	<td class="body"><font size="-1"><p>esc L</p></td>	<td class="body"><font size="-1"><p>insert line</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>2</p></td>	<td class="body"><font size="-1"><p>2</p></td>	<td class="body"><font size="-1"><p>0x54</p></td>	<td class="body"><font size="-1"><p>esc B</p></td>	<td class="body"><font size="-1"><p>down</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>3</p></td>	<td class="body"><font size="-1"><p>3</p></td>	<td class="body"><font size="-1"><p>0x55</p></td>	<td class="body"><font size="-1"><p>esc M</p></td>	<td class="body"><font size="-1"><p>delete line</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>4</p></td>	<td class="body"><font size="-1"><p>4</p></td>	<td class="body"><font size="-1"><p>0x56</p></td>	<td class="body"><font size="-1"><p>esc D</p></td>	<td class="body"><font size="-1"><p>left</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>5</p></td>	<td class="body"><font size="-1"><p>5</p></td>	<td class="body"><font size="-1"><p>0x57</p></td>	<td class="body"><font size="-1"><p>esc H</p></td>	<td class="body"><font size="-1"><p>home</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>6</p></td>	<td class="body"><font size="-1"><p>6</p></td>	<td class="body"><font size="-1"><p>0x58</p></td>	<td class="body"><font size="-1"><p>esc C</p></td>	<td class="body"><font size="-1"><p>right</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>7</p></td>	<td class="body"><font size="-1"><p>7</p></td>	<td class="body"><font size="-1"><p>0x59</p></td>	<td class="body"><font size="-1"><p>esc @/esc O</p></td>	<td class="body"><font size="-1"><p>enter/exit<br>IC mode</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>8</p></td>	<td class="body"><font size="-1"><p>8</p></td>	<td class="body"><font size="-1"><p>0x5b</p></td>	<td class="body"><font size="-1"><p>esc A</p></td>	<td class="body"><font size="-1"><p>up</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>9</p></td>	<td class="body"><font size="-1"><p>9</p></td>	<td class="body"><font size="-1"><p>0x5c</p></td>	<td class="body"><font size="-1"><p>esc N</p></td>	<td class="body"><font size="-1"><p>delete char</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>.</p></td>	<td class="body"><font size="-1"><p>.</p></td>	<td class="body"><font size="-1"><p>0x41</p></td>	<td class="body"><font size="-1"><p>.</p></td>	<td class="body"><font size="-1"><p>&nbsp;</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Enter</p></td>	<td class="body"><font size="-1"><p>Enter</p></td>	<td class="body"><font size="-1"><p>0x4c</p></td>	<td class="body"><font size="-1"><p>015</p></td>	<td class="body"><font size="-1"><p>return</p></td></tr></table></ul><br><br><!-- Alternate Keypad --><ul><table border="1" cellspacing="0" cellpadding="4"><caption><font face="Geneva,Arial" size="-1"><b>Alternate Keypad Mapping</b></caption><tr align="center" valign="top">	<th class="body"><font size="-1"><p>H-19 Key</p></th>	<th class="body"><font size="-1"><p>Mac Key</p></th>	<th class="body"><font size="-1"><p>Virtual Key Code</p></th>	<th class="body"><font size="-1"><p>Output Sequence</p></th></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>0</p></td>	<td class="body"><font size="-1"><p>0</p></td>	<td class="body"><font size="-1"><p>0x52</p></td>	<td class="body"><font size="-1"><p>esc ? p</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>1</p></td>	<td class="body"><font size="-1"><p>1</p></td>	<td class="body"><font size="-1"><p>0x53</p></td>	<td class="body"><font size="-1"><p>esc ? q</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>2</p></td>	<td class="body"><font size="-1"><p>2</p></td>	<td class="body"><font size="-1"><p>0x54</p></td>	<td class="body"><font size="-1"><p>esc ? r</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>3</p></td>	<td class="body"><font size="-1"><p>3</p></td>	<td class="body"><font size="-1"><p>0x55</p></td>	<td class="body"><font size="-1"><p>esc ? s</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>4</p></td>	<td class="body"><font size="-1"><p>4</p></td>	<td class="body"><font size="-1"><p>0x56</p></td>	<td class="body"><font size="-1"><p>esc ? t</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>5</p></td>	<td class="body"><font size="-1"><p>5</p></td>	<td class="body"><font size="-1"><p>0x57</p></td>	<td class="body"><font size="-1"><p>esc ? u</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>6</p></td>	<td class="body"><font size="-1"><p>6</p></td>	<td class="body"><font size="-1"><p>0x58</p></td>	<td class="body"><font size="-1"><p>esc ? v</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>7</p></td>	<td class="body"><font size="-1"><p>7</p></td>	<td class="body"><font size="-1"><p>0x59</p></td>	<td class="body"><font size="-1"><p>esc ? w</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>8</p></td>	<td class="body"><font size="-1"><p>8</p></td>	<td class="body"><font size="-1"><p>0x5b</p></td>	<td class="body"><font size="-1"><p>esc ? x</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>9</p></td>	<td class="body"><font size="-1"><p>9</p></td>	<td class="body"><font size="-1"><p>0x5c</p></td>	<td class="body"><font size="-1"><p>esc ? y</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>.</p></td>	<td class="body"><font size="-1"><p>.</p></td>	<td class="body"><font size="-1"><p>0x41</p></td>	<td class="body"><font size="-1"><p>esc ? n</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>Enter</p></td>	<td class="body"><font size="-1"><p>Enter</p></td>	<td class="body"><font size="-1"><p>0x4c</p></td>	<td class="body"><font size="-1"><p>esc ? M</p></td></tr></table></ul><br><br><!-- Other Mac key mappings --><p>We have a number of additional keys available on the Mac extended keyboard that we might as well take advantage of. These keys will be supported as follows:</p><ul><table border="1" cellspacing="0" cellpadding="4"><caption><font face="Geneva,Arial" size="-1"><b>Other Mac Key Mapping</b></caption><tr align="center" valign="bottom">	<th class="body"><font size="-1"><p>Mac Key</p></th>	<th class="body"><font size="-1"><p>Virtual<br>Key Code</p></th>	<th class="body"><font size="-1"><p>Normal<br>Output Sequence</p></th>	<th class="body"><font size="-1"><p>Alternate Keypad<br>Output Sequence</p></th></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>cursor up</p></td>	<td class="body"><font size="-1"><p>0x7e</p></td>	<td class="body"><font size="-1"><p>esc A</p></td>	<td class="body"><font size="-1"><p>esc ? x</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>cursor left</p></td>	<td class="body"><font size="-1"><p>0x7b</p></td>	<td class="body"><font size="-1"><p>esc D</p></td>	<td class="body"><font size="-1"><p>esc ? t</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>cursor right</p></td>	<td class="body"><font size="-1"><p>0x7c</p></td>	<td class="body"><font size="-1"><p>esc C</p></td>	<td class="body"><font size="-1"><p>esc ? v</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>cursor down</p></td>	<td class="body"><font size="-1"><p>0x7d</p></td>	<td class="body"><font size="-1"><p>esc B</p></td>	<td class="body"><font size="-1"><p>esc ? r</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>home</p></td>	<td class="body"><font size="-1"><p>0x73</p></td>	<td class="body"><font size="-1"><p>esc H</p></td>	<td class="body"><font size="-1"><p>esc ? u</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>end</p></td>	<td class="body"><font size="-1"><p>0x77</p></td>	<td class="body"><font size="-1"><p>(key suppressed)</p></td>	<td class="body"><font size="-1"><p>n/a</a></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>page up</p></td>	<td class="body"><font size="-1"><p>0x74</p></td>	<td class="body"><font size="-1"><p>(key suppressed)</p></td>	<td class="body"><font size="-1"><p>n/a</a></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>page down</p></td>	<td class="body"><font size="-1"><p>0x79</p></td>	<td class="body"><font size="-1"><p>(same as<br>shift-scroll)</p></td>	<td class="body"><font size="-1"><p>n/a</a></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>del</p></td>	<td class="body"><font size="-1"><p>0x75</p></td>	<td class="body"><font size="-1"><p>esc N</p></td>	<td class="body"><font size="-1"><p>esc ? y</p></td></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>clear<br>(keypad)</p></td>	<td class="body"><font size="-1"><p>0x47</p></td>	<td class="body"><font size="-1"><p>esc J</p></td>	<td class="body"><font size="-1"><p>n/a</a></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>shift-clear<br>(keypad)</p></td>	<td class="body"><font size="-1"><p>0x47<br>(w/ shift)</p></td>	<td class="body"><font size="-1"><p>esc E</p></td>	<td class="body"><font size="-1"><p>n/a</a></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>keypad =</p></td>	<td class="body"><font size="-1"><p>0x51</p></td>	<td class="body"><font size="-1"><p>=</p></td>	<td class="body"><font size="-1"><p>n/a</a></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>keypad /</p></td>	<td class="body"><font size="-1"><p>0x4b</p></td>	<td class="body"><font size="-1"><p>/</p></td>	<td class="body"><font size="-1"><p>n/a</a></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>keypad *</p></td>	<td class="body"><font size="-1"><p>0x43</p></td>	<td class="body"><font size="-1"><p>*</p></td>	<td class="body"><font size="-1"><p>n/a</a></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>keypad -</p></td>	<td class="body"><font size="-1"><p>0x4e</p></td>	<td class="body"><font size="-1"><p>-</p></td>	<td class="body"><font size="-1"><p>n/a</a></tr><tr align="center" valign="top">	<td class="body"><font size="-1"><p>keypad +</p></td>	<td class="body"><font size="-1"><p>0x45</p></td>	<td class="body"><font size="-1"><p>+</p></td>	<td class="body"><font size="-1"><p>n/a</a></tr></table></ul><br><br><p>Finally, there are eight command keys with local functionality. Note that the command key is held down to activate each key.</p><ul><table border="1" cellspacing="0" cellpadding="4"><caption><font face="Geneva,Arial" size="-1"><b>Local Command Keys</b></caption><tr align="center" valign="bottom">	<th class="body"><font size="-1"><p>Mac Key</p></th>	<th class="body"><font size="-1"><p>Virtual<br>Key Code</p></th>	<th class="body"><font size="-1"><p>Emulator Function</p></th></tr><tr align="left" valign="top">	<td class="body"><font size="-1"><p>command-clear</p></td>	<td class="body" align="center"><font size="-1"><p>0x47</p></td>	<td class="body"><font size="-1"><p>Clears the H-19 screen without transmitting anything to the H8.</p></td></tr><tr align="left" valign="top">	<td class="body"><font size="-1"><p>command-F9 (scroll)</p></td>	<td class="body" align="center"><font size="-1"><p>0x19</p></td>	<td class="body"><font size="-1"><p>Toggles hold mode on/off locally, without transmitting anything to the H8.</p></td></tr><tr align="left" valign="top">	<td class="body"><font size="-1"><p>command-home</p></td>	<td class="body" align="center"><font size="-1"><p>0x73</p></td>	<td class="body"><font size="-1"><p>Scrolls to the top of the 500-line scroll-back buffer.</p></td></tr><tr align="left" valign="top">	<td class="body"><font size="-1"><p>command-end</p></td>	<td class="body" align="center"><font size="-1"><p>0x77</p></td>	<td class="body"><font size="-1"><p>Scrolls to the bottom of the 500-line scroll-back buffer.</p></td></tr><tr align="left" valign="top">	<td class="body"><font size="-1"><p>command-page up</p></td>	<td class="body" align="center"><font size="-1"><p>0x74</p></td>	<td class="body"><font size="-1"><p>Scrolls up one page (23 lines) in the scroll-back buffer.</p></td></tr><tr align="left" valign="top">	<td class="body"><font size="-1"><p>command-page down</p></td>	<td class="body" align="center"><font size="-1"><p>0x79</p></td>	<td class="body"><font size="-1"><p>Scrolls down one page (23 lines) in the scroll-back buffer.</p></td></tr><tr align="left" valign="top">	<td class="body"><font size="-1"><p>command-up arrow</p></td>	<td class="body" align="center"><font size="-1"><p>0x7e</p></td>	<td class="body"><font size="-1"><p>Scrolls up one line in the scroll-back buffer.</p></td></tr><tr align="left" valign="top">	<td class="body"><font size="-1"><p>command-down arrow</p></td>	<td class="body" align="center"><font size="-1"><p>0x7d</p></td>	<td class="body"><font size="-1"><p>Scrolls down one line in the scroll-back buffer.</p></td></tr></table></ul><br><br><p>The scroll command keys effectively duplicate the functionality of the H-19 window scroll bar.</p><p><a href="#top" onMouseOver="self.status='go to the top of this page'; return true">go to top</a></p><hr><a name="graphics"></a><p><b>H-19 Graphics Character Generation</b></p><p>The emulator uses a modified a copy of the Monaco 10-point font which contains the H-19 graphic characters. The font is named "Heath 10."</p><p>The graphic characters replace the special characters at ASCII offset 336Q through 376Q in the font set ("Q" indicates octal notation). To display a graphics character, add 200Q to the corresponding ASCII character. Example: The first graphics character is the raised dot, corresponding with the ^ character, which is ASCII 136Q. 136Q + 200Q = 336Q or 222D, which is where the raised dot is in the font.</p><p>Here is the full set of graphics characters along with the octal and graphic representation of the corresponding normal character.</p><img src="gfx/graph.gif" alt="H-19 Graphics Characters"><p clear="all"><a href="#top" onMouseOver="self.status='go to the top of this page'; return true">go to top</a></p><hr><a name="pacing"></a><p><b>Character Pacing</b></p><p>As noted in <a href="#overview" onMouseOver="self.status='Go to overview'; return true">H-19 Overview</a>, all characters to be sent to the H8 are placed into a receive buffer. H8 input must be paced so that we don't exceed around 500 characters per second.</p><p>The mechanism used is the 1ms emulation clock tick. On every other tick, we check to see whether there's a character in the buffer. If so, that character is placed on the UART via a call to ioPutSerialData.</p><p>For any given keystroke, there is a delay of up to 2ms before it appears on the UART. At present, there's a delay of up to 25ms before we get that keystroke from the Mac Event Manager, and this extra delay isn't noticeable.</p><p>(The original plan had been to input at a rate of around 1,000 cps. In testing this proved to be too fast for the emulated H8, which lost the occasional leading ESC character in a function key sequence. Slowing the rate to 500 cps has proven to be 100% reliable.)</p><p>Starting with release 4.1, outbound characters are paced so that output does not exceed 2,000 characters per second. Again, this is done using the 1ms emulation clock tick. On each tick, a 2-character output quota is refreshed. h19Status (ref. <a href="design_io.html" onMouseOver="self.status='Go to i/o package'; return true">I/O Package</a>) will return transmitterEmpty status only if this count is non-zero.</p><p><a href="#top" onMouseOver="self.status='go to the top of this page'; return true">go to top</a></p><hr><a name="output"></a><p><b>Output Character Processing</b><p><b>Note</b> &#8212; Output, in this case, refers to characters sent by the H8 to the H-19 terminal.</p><p><i>Logic</i></p><p>H-19 terminal output processing is table driven, using a series of tables that taken together denote the state of the output data stream. Each time a character is output, the current table is searched and the appropriate action taken.</p><p>The tables are defined as follows:</p><ul><pre>typedef struct {    unsigned char outputChar;   // output by the H8    int nextTableNdx;           // next table ndx    void (*procRoutine) (void); // processing routine} outXlateTab, *outXlateTabPtr;outXlateTabPtr nextTable[] = { outNormal, outEsc, ... };</pre></ul><p>If the processing routine is nil, none will execute. But the table address will change to the next table. The last entry, outputChar = 0xff, will match any character output.</p><p>Let's process one easy example. The initial state has the current table set to the default table.</p><ol><li><p>A character (ESC) is output. We search the current table and find the character. Processing routine is nil so nothing is done. The current table pointer is changed (outEsc).</p></li><li><p>A character (Y) is output. We search the current table and find the character. Processing routine is nil so nothing is done. The current table pointer is changed (outRow).</p></li><li><p>A character (row) is output. We search the current table and find the final, default entry. Processing routine saves the row number. The current table pointer is changed (outCol).</p></li><li><p>A character (col) is output. We search the current table and find the final, default entry. Processing routine saves the column number, and moves the cursor to the correct coordinates. The current table pointer is changed (outNormal).</p></li><li><p>A character (A) is output. We search the current table and find the final, default entry. Processing routine updates the screen and moves the cursor to the right. The current table pointer is changed (outNormal).</p></li></ol><p>The cascading order of tables effectively parses the output and sees that the correct function is performed for each character or escape sequence.</p><p><i>Output Escape Sequences</i></p><p>The characters following "esc" in the following tables are case sensitive. Esc is, of course, 033q (27d).</p><ul><table border="1" cellspacing="0" cellpadding="4"><caption><font face="Geneva,Arial" size="-1"><b>Cursor Functions</b></caption><tr align="left" valign="middle">	<th class="body"><font size="-1"><p>Escape Sequence</p></th>	<th class="body"><font size="-1"><p>Mnemonic</p></th>	<th class="body"><font size="-1"><p>Definition</p></th></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc H</p></td>	<td class="body"><font size="-1"><p>HCUH</p></td>	<td class="body"><font size="-1"><p>cursor home</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc C</p></td>	<td class="body"><font size="-1"><p>HCUF</p></td>	<td class="body"><font size="-1"><p>cursor forward</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc D</p></td>	<td class="body"><font size="-1"><p>HCUB</p></td>	<td class="body"><font size="-1"><p>cursor backward</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc B</p></td>	<td class="body"><font size="-1"><p>HCUD</p></td>	<td class="body"><font size="-1"><p>cursor down</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc A</p></td>	<td class="body"><font size="-1"><p>HCUU</p></td>	<td class="body"><font size="-1"><p>cursor up</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc I</p></td>	<td class="body"><font size="-1"><p>HRI</p></td>	<td class="body"><font size="-1"><p>reverse index</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc n</p></td>	<td class="body"><font size="-1"><p>HCPR</p></td>	<td class="body"><font size="-1"><p>cursor position report</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc j</p></td>	<td class="body"><font size="-1"><p>HSCP</p></td>	<td class="body"><font size="-1"><p>save cursor position</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc k</p></td>	<td class="body"><font size="-1"><p>HRCP</p></td>	<td class="body"><font size="-1"><p>set cursor to previously saved position</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc Y r c</p></td>	<td class="body"><font size="-1"><p>HDCA</p></td>	<td class="body"><font size="-1"><p>direct cursor addressing</p></td></tr></table></ul><br><br><p>Additional information:</p><dl><dt>cursor motion</dt><dd><p>None of the cursor movement functions in this table will cause the screen to scroll or move the cursor past the margins of the screen. For example, HCUU on line 1 will leave the cursor on line 1.</p><p>HCUU and HCUD do nothing when the cursor is on line 25.</p></dd><dt>HCPR</dt><dd><p>The response to Cursor Position Report is the sequence "esc Y r+31, c+31" where 'r' and 'c' are the current cursor row and column.</p></dd><dt>HRI</dt><dd><p>Reverse Index is Line Feed in reverse. HRI will move the cursor up one row. When issued with the cursor on line 1, the screen is scrolled down one line and a new blank line is opened on line 1.</p><p>(Note: The character following esc is an upper-case I ("eye")).</p></dd><dt>HDCA</dt><dd><p>Position the cursor to a specific row and column. The cursor is positioned to row 'r'-31 and column 'c'-31. If the resulting row is invalid, the cursor stays on its current row. If the resulting column is invalid, the cursor moves to column 80.</p><p>Direct Cursor Addressing is the only way to move the cursor to line 25. Line 25 must be enabled before moving the cursor there. Otherwise, it's considered to be invalid and the cursor will stay in its current row.</p></dd></dl><ul><table border="1" cellspacing="0" cellpadding="4"><caption><font face="Geneva,Arial" size="-1"><b>Erasing and Editing</b></caption><tr align="left" valign="middle">	<th class="body"><font size="-1"><p>Escape Sequence</p></th>	<th class="body"><font size="-1"><p>Mnemonic</p></th>	<th class="body"><font size="-1"><p>Definition</p></th></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc E</p></td>	<td class="body"><font size="-1"><p>HCD</p></td>	<td class="body"><font size="-1"><p>clear display (shift erase key)</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc b</p></td>	<td class="body"><font size="-1"><p>HBD</p></td>	<td class="body"><font size="-1"><p>erase beginning of display</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc J</p></td>	<td class="body"><font size="-1"><p>HEOP</p></td>	<td class="body"><font size="-1"><p>erase to end of page (erase key)</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc l</p></td>	<td class="body"><font size="-1"><p>HEL</p></td>	<td class="body"><font size="-1"><p>erase entire line</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc o</p></td>	<td class="body"><font size="-1"><p>HEBL</p></td>	<td class="body"><font size="-1"><p>erase beginning of line</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc K</p></td>	<td class="body"><font size="-1"><p>HEOL</p></td>	<td class="body"><font size="-1"><p>erase to end of line</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc L</p></td>	<td class="body"><font size="-1"><p>HIL</p></td>	<td class="body"><font size="-1"><p>insert line</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc M</p></td>	<td class="body"><font size="-1"><p>HDL</p></td>	<td class="body"><font size="-1"><p>delete line</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc N</p></td>	<td class="body"><font size="-1"><p>HDCH</p></td>	<td class="body"><font size="-1"><p>delete character</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc @</p></td>	<td class="body"><font size="-1"><p>HEIM</p></td>	<td class="body"><font size="-1"><p>enter insert character mode</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc O</p></td>	<td class="body"><font size="-1"><p>HERM</p></td>	<td class="body"><font size="-1"><p>exit insert character mode</p></td></tr></table></ul><br><br><p>Additional information:</p><dl><dt>HIL</dt><dd><p>After an insert line, the cursor is left in column 1 of the inserted line.</p></dd><dt>HDL</dt><dd><p>After a delete line, the cursor is left in column 1 of the line following the deleted line. A new blank line is inserted on line 24.</p></dd><dt>HEL</dt><dd><p>The character following the esc is a lower case L.</p></dd></dl><ul><table border="1" cellspacing="0" cellpadding="4"><caption><font face="Geneva,Arial" size="-1"><b>Configuration</b></caption><tr align="left" valign="middle">	<th class="body"><font size="-1"><p>Escape Sequence</p></th>	<th class="body"><font size="-1"><p>Mnemonic</p></th>	<th class="body"><font size="-1"><p>Definition</p></th></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc z</p></td>	<td class="body"><font size="-1"><p>HRAM</p></td>	<td class="body"><font size="-1"><p>reset to power up configuration</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc x [n]</p></td>	<td class="body"><font size="-1"><p>HSM</p></td>	<td class="body"><font size="-1"><p>set (enable) operating mode</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc y [n]</p></td>	<td class="body"><font size="-1"><p>HRM</p></td>	<td class="body"><font size="-1"><p>reset (disable) operating mode</p></td></tr></table></ul><br><br><p>The following Configuration Modes replace the [n] in the HSM and HRM sequences above.</p><ul><table border="1" cellspacing="0" cellpadding="4"><caption><font face="Geneva,Arial" size="-1"><b>Configuration Modes</b></caption><tr align="left" valign="top">	<th class="body"><font size="-1"><p>Configuration Mode</p></th>	<th class="body"><font size="-1"><p>Definition</p></th></tr><tr align="left" valign="top">	<td class="body" align="center"><font size="-1"><p>1</p></td>	<td class="body"><font size="-1"><p>enable/disable line 25</p></td></tr><tr align="left" valign="top">	<td class="body" align="center"><font size="-1"><p>3</p></td>	<td class="body"><font size="-1"><p>enable/disable hold screen mode</p></td></tr><tr align="left" valign="top">	<td class="body" align="center"><font size="-1"><p>4</p></td>	<td class="body"><font size="-1"><p>enable/disable block cursor</p></td></tr><tr align="left" valign="top">	<td class="body" align="center"><font size="-1"><p>5</p></td>	<td class="body"><font size="-1"><p>enable/disable cursor off</p></td></tr><tr align="left" valign="top">	<td class="body" align="center"><font size="-1"><p>6</p></td>	<td class="body"><font size="-1"><p>enable/disable shifted keypad</p></td></tr><tr align="left" valign="top">	<td class="body" align="center"><font size="-1"><p>7</p></td>	<td class="body"><font size="-1"><p>enable/disable alternate keypad mode</p></td></tr><tr align="left" valign="top">	<td class="body" align="center"><font size="-1"><p>8</p></td>	<td class="body"><font size="-1"><p>enable/disable auto line feed on receipt of CR</p></td></tr><tr align="left" valign="top">	<td class="body" align="center"><font size="-1"><p>9</p></td>	<td class="body"><font size="-1"><p>enable/disable auto CR on receipt of line feed</p></td></tr></table></ul><br><br><p>Additional information:</p><dl><dt>unsupported Heath functions</dt><dd><p>A real H-19 will also support:</p><ul type="disc"><li>modify baud rate (esc r [b])</li><li>disable/enable key click (esc x 2 & esc y 2)</li><li>enter ANSI mode (esc &lt;)</li></ul><p>These are not supported by this emulator. You can send the sequences to the terminal and they will be "eaten" but not processed.</p></dd><dt>enable/disable cursor</dt><dd><p>Please notice the odd case, here: You are enabling the cursor to be off, and disabling that condition to turn the cursor on. </p></dd></dl><ul><table border="1" cellspacing="0" cellpadding="4"><caption><font face="Geneva,Arial" size="-1"><b>Modes of Operation</b></caption><tr align="left" valign="middle">	<th class="body"><font size="-1"><p>Escape Sequence</p></th>	<th class="body"><font size="-1"><p>Mnemonic</p></th>	<th class="body"><font size="-1"><p>Definition</p></th></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc [</p></td>	<td class="body"><font size="-1"><p>HEHS</p></td>	<td class="body"><font size="-1"><p>enter hold screen mode</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc \</p></td>	<td class="body"><font size="-1"><p>HXHS</p></td>	<td class="body"><font size="-1"><p>exit hold screen mode</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc p</p></td>	<td class="body"><font size="-1"><p>HERV</p></td>	<td class="body"><font size="-1"><p>enter reverse video mode</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc q</p></td>	<td class="body"><font size="-1"><p>HXRV</p></td>	<td class="body"><font size="-1"><p>exit reverse video mode</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc F</p></td>	<td class="body"><font size="-1"><p>HEGM</p></td>	<td class="body"><font size="-1"><p>enter graphics mode</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc G</p></td>	<td class="body"><font size="-1"><p>HXGM</p></td>	<td class="body"><font size="-1"><p>exit graphics mode</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc t</p></td>	<td class="body"><font size="-1"><p>HEKS</p></td>	<td class="body"><font size="-1"><p>enter keypad shifted mode</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc u</p></td>	<td class="body"><font size="-1"><p>HXKS</p></td>	<td class="body"><font size="-1"><p>exit keypad shifted mode</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc =</p></td>	<td class="body"><font size="-1"><p>HAKM</p></td>	<td class="body"><font size="-1"><p>enter alternate keypad mode</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc ></p></td>	<td class="body"><font size="-1"><p>HXAM</p></td>	<td class="body"><font size="-1"><p>exit alternate keypad mode</p></td></tr></table></ul><br><br><p>Additional information:</p><dl><dt>hold screen mode</dt><dd><p>You can toggle hold screen mode locally by typing command-Scroll (that's command F9 or command-option-9). This local toggle does not transmit escape sequences to the H-19.</p></dd><dt>alternate keypad</dt><dd><p>The keypad in alternate mode replaces the normal mode; it is not possible to get the digits 1-9 from the keypad until you exit alternate keypad mode.</p><p>The shifted-mode sequences are not affected by alternate keypad mode.</p></dd><dt>shifted keypad</dt><dd><p>Shifted keypad mode reverses the shift mode of the keypad. For example: when in keypad shifted mode pressing '1' will send the Insert Line sequence, while pressing shift-1 will send either '1' or esc ? q, depending on the alternate keypad mode setting.</p></dd></dl><ul><table border="1" cellspacing="0" cellpadding="4"><caption><font face="Geneva,Arial" size="-1"><b>Additional Functions</b></caption><tr align="left" valign="middle">	<th class="body"><font size="-1"><p>Escape Sequence</p></th>	<th class="body"><font size="-1"><p>Mnemonic</p></th>	<th class="body"><font size="-1"><p>Definition</p></th></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc v</p></td>	<td class="body"><font size="-1"><p>HEWA</p></td>	<td class="body"><font size="-1"><p>wrap around at end of line</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc w</p></td>	<td class="body"><font size="-1"><p>HXWA</p></td>	<td class="body"><font size="-1"><p>discard at end of line</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc Z</p></td>	<td class="body"><font size="-1"><p>HID</p></td>	<td class="body"><font size="-1"><p>identify as VT52 (send esc K)</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc ]</p></td>	<td class="body"><font size="-1"><p>HX25</p></td>	<td class="body"><font size="-1"><p>transmit 25th line</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>esc #</p></td>	<td class="body"><font size="-1"><p>HXMP</p></td>	<td class="body"><font size="-1"><p>transmit page</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>cr</p></td>	<td class="body"><font size="-1"><p>&nbsp;</p></td>	<td class="body"><font size="-1"><p>carriage return</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>lf</p></td>	<td class="body"><font size="-1"><p>&nbsp;</p></td>	<td class="body"><font size="-1"><p>line feed</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>bel</p></td>	<td class="body"><font size="-1"><p>&nbsp;</p></td>	<td class="body"><font size="-1"><p>bell</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>tab</p></td>	<td class="body"><font size="-1"><p>&nbsp;</p></td>	<td class="body"><font size="-1"><p>horizontal tab</p></td></tr><tr align="left" valign="middle">	<td class="body"><font size="-1"><p>bs</p></td>	<td class="body"><font size="-1"><p>&nbsp;</p></td>	<td class="body"><font size="-1"><p>backspace</p></td></tr></table></ul><br><br><p>Additional information:</p><dl><dt>unsupported Heath functions</dt><dd><p>A real H-19 will also support enable/disable keyboard (esc { and esc }). These are ignored in this emulator.</p></dd><dt>HID</dt><dd><p>Sending HID simply causes the emulator to return esc K. Pointless? Sure. But there it is.</p></dd><dt>HX25 and HXMP</dt><dd><p>These sequences will cause line 25 or lines 1-24 to be transmitted to the H8. Transmission proceeds as follows:</p><ul type="disc"><li>each character is sent in turn starting at line 1 column 1 and proceeding across then down the screen;</li><li>when transmitting the main screen, the cursor wraps from column 80 to column 1 of the next line but with no carriage return or line feed between lines;</li><li>the appropriate escape sequences are sent to enter and exit reverse video and graphics modes, depending on the characters encountered on the screen &#8212; effectively, what you get back is what you sent in the first place;</li><li>when the transmission is complete, a single carriage return is sent and the H-19 bell rings.</li></ul><p>Due to the enter/exit reverse video and graphics sequences, the amount of data returned can be significantly more than the 80 or 1,920 characters on lines 25 and the main screen body, respectively. For example, if the last two characters on the screen are a normal character followed by a reverse-video graphics character, the last character of the screen will actually cause nine characters to be transmitted: enter reverse video, enter graphics, the character, exit reverse video, and exit graphics.</p><p>If there is a long string of text in a particular mode, the mode is changed only at the beginning and end of the string.</p><p>If line 25 is not enabled, HX25 will return only a carriage return.</p></dd><dt>horizontal tab</dt><dd><p>Tab will cause the cursor to move to the next tab stop. The tab stops are fixed at columns 8, 16, 24 , 32, 40, 48, 56, 64, 72, 73, 74, 75, 76, 77, 78, 79 and 80. A tab in column 80 will not move the cursor.</p><p>Tab moves the cursor over the characters on the screen. Blanks are neither inserted nor written over the characters on the screen.</p></dd></dl></ul><p><a href="#top" onMouseOver="self.status='go to the top of this page'; return true">go to top</a></p><hr><a name="cursor"></a><p><b>Cursor Display</b></p><p>H-19 emulation spends an extraordinary amount of time drawing and undrawing the cursor. This was mitigated to a degree by batching character output; the cursor is removed and drawn for each small batch of characters instead of for each character output. But when there's a long, fast burst of output, all that cursor drawing is just unnecessary overhead.</p><p>QuickDraw is blazing fast, but overhead is overhead.</p><p>This overhead was removed by delaying the drawing of the cursor on the screen. The amount of delay could have been anything, really, but testing showed that at 25ms a human operator can actually see the delay. I settled on 10ms because cursor motion is uniform and smooth when typing or moving the cursor by hand, and yet it's long enough to ride over small gaps in a burst of output.</p><p>Cursor display is now done in the 1ms clock tick processing routine, and is controlled by three variables:</p><ul><pre>int h19CursorDisplayed;     // cursor has been drawnint h19CursorDesired;       // cursor should be drawnint h19CursorTimer;         // 10ms delay timer</pre></ul><p>H-19 processing routines call insertCursor and removeCursor to put the cursor on the screen and take it off, respectively.</p><dl><dt>insertCursor</dt><dd><p>Instead of drawing the cursor, insertCursor sets h19CursorDesired to '1' and sets h19CursorTimer to 10. Unless removeCursor is called during that 10ms delay period, the cursor should appear on screen in 9-10ms.</p></dd><dt>removeCursor</dt><dd><p>If h19CursorDisplayed = 1, the cursor is removed from the screen and h19CursorDisplayed is set to 0. In either case, h19CursorDesired is set to zero.</p></dd><dt>h19Clock</dt><dd><p>If h19CursorDesired is set, h19Clock counts down the clock and calls drawCursor when the timer hits zero. (This among other functions.)</p></dd><dt>drawCursor</dt><dd><p>drawCursor draws the actual cursor on screen, clears h19CursorDesired, and sets h19CursorDisplayed.</p></dd></dl><p><b>Note</b> &#8212; Regardless, the cursor is never displayed on screen if the cursor has been disabled (h19ModeCursor = 0) by an output escape sequence.</p><p>The cursor itself defaults to an underline, and can be configured as a block. The underline cursor is a black line drawn using modeXor so that it is visible in both reverse and normal video. The cursor is erased by simply redrawing the cursor.</p><p>The block cursor is drawn using the PaintRect function, with a drawing mode of patXor. As such, it shows on a normal screen as a black box with a reverse-video character inside, and is reversed on a reverse-video character. When the cursor is idle, it blinks at a rate of: on for one second, off for one-half second. The blink is accomplished simply by calling removeCursor and insertCursor.</p><p><a href="#top" onMouseOver="self.status='go to the top of this page'; return true">go to top</a></p></font><br></p></td></tr></table><!-- Footer area -- common to all pages --><hr><div class="c1"><font size="-1"><a href="index.html" onMouseOver="self.status='Go to Heath8080A home page'; return true">home</a>&nbsp;<a href="release.html" onMouseOver="self.status='Go to release page'; return true">release</a>&nbsp;<a href="support.html" onMouseOver="self.status='Go to support page'; return true">support</a>&nbsp;<a href="design.html" onMouseOver="self.status='Go to design page'; return true">design</a>&nbsp;<a href="resources.html" onMouseOver="self.status='Go to resources page'; return true">resources</a>&nbsp;<a href="legal.html" onMouseOver="self.status='Go to legal page'; return true">legal</a>&nbsp;<a href="sitemap.html" onMouseOver="self.status='Go to site map'; return true">site map</a>&nbsp;</font></div><hr><br></body>
<!-- Mirrored from davidwallace2000.home.comcast.net/~davidwallace2000/h8/project8080_archive/design_h19.html by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 10 Sep 2012 13:15:36 GMT -->
</html>
